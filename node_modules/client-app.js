var socket = io.connect();
var send_button = $("#send-message");
var username = '';

var client_msg_format = "<div class=\"row\"><div class=\"panel panel-default\" style=\"float:right;margin-top:12px;margin-right:8px;margin-bottom:0\"><div class=\"panel-body\">%s%</div></div></div>";
send_button.click( function(){
	var msg = $("#msg-content").val();
	if(msg) {
		var json = {"username" : username, "msg" : msg};
		console.log(json);
		socket.emit('message', json);
		var client_msg = client_msg_format.replace("%s%", msg);
		$(".wrapper").append(client_msg);
		$("#msg-content").val('');
	}
	
});
var server_msg_format = "<div class=\"row\"><div class=\"panel panel-default\" style=\"float:left;margin-top:12px;margin-left :8px;margin-bottom:0;background-color:#2cb94a;border-color:#55c142\"><div class=\"panel-body\">%s%</div></div></div>";
socket.on("user_login", function(data){
	layer.prompt({
		formType: 2,
		  value: '',
		  title: '请输入您的用户名',
	}, function(value, index, elem){
		socket.emit("user_login", value);
		layer.close(index);
		username = value;
	});
});
socket.on("error_info", function(data){
	layer.msg(data, {icon:2, time:2000});
});
socket.on("message", function(json){
	console.log(json);
	var server_msg = server_msg_format.replace("%s%", json.msg);
	$(".wrapper").append(server_msg);
})
socket.on("login_success", function(data){
	layer.msg(data, {icon:1, time:2000});
})
